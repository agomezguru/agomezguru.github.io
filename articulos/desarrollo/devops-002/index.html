<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Ejemplo de replicación básica en MySQL 8 empleando contenedores de Docker - Taller práctico"><meta name=generator content="Hugo 0.109.0"><title>Replicación maestro-esclavo en MySQL 8.x | GitHub Blog</title><link rel=canonical href=https://agomezguru.github.io/articulos/desarrollo/devops-002/><link href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;500;600;700&display=swap" rel=stylesheet><link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800&display=swap" rel=stylesheet><link rel=stylesheet href=https://agomezguru.github.io/css/style-liberty.css><meta property="og:title" content="Replicación maestro-esclavo en MySQL 8.x"><meta property="og:description" content="Ejemplo de replicación básica en MySQL 8 empleando contenedores de Docker - Taller práctico"><meta property="og:type" content="article"><meta property="og:url" content="https://agomezguru.github.io/articulos/desarrollo/devops-002/"><meta property="og:image" content="https://agomezguru.github.io/articulos/desarrollo/devops-002/cover.jpg"><meta property="article:section" content="articulos"><meta property="article:published_time" content="2023-04-01T13:18:52-06:00"><meta property="article:modified_time" content="2023-04-01T13:18:52-06:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://agomezguru.github.io/articulos/desarrollo/devops-002/cover.jpg"><meta name=twitter:title content="Replicación maestro-esclavo en MySQL 8.x"><meta name=twitter:description content="Ejemplo de replicación básica en MySQL 8 empleando contenedores de Docker - Taller práctico"></head><body><header class=w3l-header><nav class="navbar navbar-expand-lg navbar-light fill px-lg-0 py-0 px-3"><div class=container><a class=navbar-brand href=https://agomezguru.github.io><span class="fa fa-pencil-square-o"></span>GitHub Blog</a>
<button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class="fa icon-expand fa-bars"></span>
<span class="fa icon-close fa-times"></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class="nav-item active"><a class=nav-link href=/>Inicio</a></li><li class="nav-item dropdown @@category__active"><a class="nav-link dropdown-toggle" href id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Artículos <span class="fa fa-angle-down"></span></a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class="dropdown-item @@ls__active" href=/articulos/desarrollo/>Desarrollo</a>
<a class="dropdown-item @@ls__active" href=/articulos/inteligencia_artificial/>Inteligencia artificial</a></div></li><li class="nav-item active"><a class=nav-link href=/more>Ver más</a></li><li class="nav-item active"><a class=nav-link href=/contacto>Contáctame</a></li></ul><div class="search-right mt-lg-0 mt-2"><a href=#search title=search><span class="fa fa-search" aria-hidden=true></span></a><div id=search class=pop-overlay><div class=popup><h3 class="hny-title two">Búsqueda</h3><form action=search-results.html method=get class=search-box><input type=search placeholder="Buscar entradas de blog" name=search required autofocus>
<button type=submit class=btn>Buscar</button></form><a class=close href=#close>×</a></div></div></div><div class="header-author d-flex ml-lg-4 pl-2 mt-lg-0 mt-3"><a class="img-circle img-circle-sm" href=/acerca_de><img src=/images/agomezguru_hu9c1ce3421dee7158921185cdd344cfa2_12722_60x0_resize_q75_h2_box.webp class=img-fluid alt=agomezguru_author_icon></a><div class="align-self ml-3"><a href=/acerca_de><h5>agomezguru</h5></a><span>Autor del Blog</span></div></div></div><div class=mobile-position><nav class=navigation><div class=theme-switch-wrapper><label class=theme-switch for=checkbox><input type=checkbox id=checkbox><div class=mode-container><i class=gg-sun></i>
<i class=gg-moon></i></div></label></div></nav></div></div></nav></header><nav id=breadcrumbs class=breadcrumbs><div class="container page-wrapper"><a href=https://agomezguru.github.io/>GitHub Blog</a>
/&nbsp;
<a href=https://agomezguru.github.io/articulos/>Artículos</a>
/&nbsp;
<a href=https://agomezguru.github.io/articulos/desarrollo/>Desarrollo</a>
/
<span class=breadcrumb_last aria-current=page>Replicación maestro-esclavo en MySQL 8.x</span></div></nav><main id=content><div class="py-5 w3l-homeblock1 text-center"><div class="container mt-md-3"><h3 class="blog-desc-big text-center mb-4">Replicación maestro-esclavo en MySQL 8.x</h3><div class=blog-post-align><div class=blog-post-img><a href=/acerca_de><img src=/images/agomezguru_hu9c1ce3421dee7158921185cdd344cfa2_12722_60x0_resize_q75_h2_box.webp alt=agomezguru_blog_image class="rounded-circle img-fluid"></a></div><div class=blog-post-info><div class="author align-items-center mb-1"><a href=/acerca_de>Publicado: April 1, 2023</a> en
<a href=/etiquetas/devops>DevOps</a>
<a href=/etiquetas/dbs>DB's</a>
<a href=/etiquetas/replicaci%C3%B3n>Replicación</a>
<a href=/etiquetas/taller>Taller</a></div><ul class=blog-meta><li class="meta-item blog-lesson"><span class=meta-value>April 21, 2023</span></li><li class="meta-item blog-students"><span class=meta-value>Lectura: 14 mins.</span></li></ul></div></div></div></div><section class="blog-post-main w3l-homeblock1"><article class="blog-content-inf pb-5"><div class="container pb-lg-4"><div class=single-post-image><div class=post-content><img src=https://agomezguru.github.io/articulos/desarrollo/devops-002/cover_hu92e29c8bd5753e52f5cd64589930e3cb_75966_1150x0_resize_q75_h2_box.webp width=1150 loading=lazy class="radius-image img-fluid mb-5" alt="Replicación maestro-esclavo en MySQL 8.x"></div></div><div class=single-post-content><p class="alphabet mb-4"><span class=big-letter>L</span>as bases de datos son uno de los elementos clave de toda aplicación web, a no ser que se trate de un simple blog desplegado como un sitio estático. Así, en esta ocasión revisaremos juntos un típico caso de uso de las bases de datos relacionales.</p><p class=mb-4>Probablemente si en este momento te encuentras operando tu aplicación web y utilizas un sistema de base de datos relacional (RDBMS) y no cuentas con un presupuesto cuantioso, la probabilidad de que estés empleando <a href=https://db-engines.com/en/ranking>MySQL/MariaDB/Percona es bastante alta</a>, por ello la elegí como motor de base de datos, para mostrar en este <em>taller práctico</em> de ejemplo de uso de contenedores Docker. Además, si este es tu caso, seguramente te servirá de guía muy útil.</p><h3 id=replicación-maestro-esclavo class="blog-desc-big m-0 mb-4">Replicación maestro-esclavo</h3><p class=mb-4>Ciertamente eres un excelente programador. Tu y tu equipo de trabajo realizaron una gran labor, ahora tu aplicación ha empezado a recibir una gran cantidad de tráfico diario y las operaciones de lectura-escritura en disco están empezando a ser un problema. Ya lo solucionaste, cambiaste el disco de trabajo principal por uno de estado sólido, pero las cosas se están poniendo verdaderamente difíciles. Empezaste con 8 Mb de RAM, luego lo creciste a 16, 24, 32 y las cuentas $$$ de tu servidor en nube también están creciendo junto con ella. Es hora de cambiar de táctica, eso que has estado haciendo se denomina escalado vertical de una aplicación, llegó el momento de crecer hacia los lados (escalado horizontal) agregando más máquinas, pero eso también cuesta y es aquí donde entran los contenedores de Docker. Pero antes de imbuirnos en los detalles, primero definamos sin ambigüedades que es esto de la replicación maestro-esclavo.</p><p class=mb-4>La replicación es el proceso mediante el cual las tablas de un servidor de base de datos MySQL (el maestro) se sincronizan automáticamente a uno o más servidores de base de datos MySQL (los esclavos). En el caso de tener múltiples esclavos se denomina clúster esclavo. Muy importante, la replicación no debe confundirse con las operaciones de copia de seguridad, ya que estas tienen un objetivo totalmente distinto, proteger los datos o la estructura de datos. En contraposición, la función de la replicación es, primordialmente, distribuir las cargas de trabajo de lectura y escritura en varios servidores con fines de escalabilidad. En casos muy específicos, la replicación también se emplea para la conmutación por error (yo prefiero más el método blue/green) o para analizar datos en el esclavo, a fin de disminuir la carga de trabajo del maestro. Este último es otro caso de uso típico que podemos abordar en un futuro.</p><p class=mb-4>La replicación maestro-esclavo es casi siempre una replicación unidireccional, de maestro a esclavo, en la que la base de datos maestra se emplea para operaciones de escritura, mientras que las operaciones de lectura pueden realizarse en una única base de datos esclava o distribuirse entre varios esclavos. Esto se debe a que la proporción de solicitudes de lectura casi siempre es más alta que la de escritura para la mayoría de las aplicaciones. Además, es muy importante mantener la coherencia en los datos y así el maestro se convierte en la única fuente de verdad, aunque agrega un problema adicional, también se vuelve un único punto de falla (esto lo abordaré en otro artículo). Por otra parte, si tu servidor de base de datos de lectura (el esclavo) comienza a tener dificultades de sobrecarga, siempre podrás agregar servidores de lectura adicionales al clúster (escalado horizontal de los servidores de bases de datos).</p><p class=mb-4>Un escenario más raro es donde el(los) servidor(es) de base de datos realizan más escrituras que lecturas y requiere de otra topología llamada fragmentación y por el momento, no es tema.</p><p class=mb-4>El maestro y el(los) esclavo(s) pueden residir en el mismo servidor físico o en servidores diferentes, pero como ya lo mencioné, no queremos escalar los costos a la par, sino todo lo contrario. Por ello vamos a colocar ambos en la misma máquina empleando contenedores de Docker, que además ofrece algunas ventajas de rendimiento y seguridad al omitir el traslado de los datos a través de la red o la conexión a Internet.</p><p class=mb-4>El proceso de replicación Maestro -> Esclavo puede ser síncrono o asíncrono. La diferencia radica en el tiempo: si los cambios se realizan en el Maestro y el Esclavo al mismo tiempo, se dice que el proceso es sincrónico; si los cambios se ponen en cola y se escriben más tarde, el proceso se considera asíncrono.</p><p class=mb-4>Hay varias formas de propagar cambios a las bases de datos esclavas. Uno de ellos muy empleado es la replicación basada en triggers, en donde los triggers en las columnas del servidor maestro propagan los cambios de escritura al servidor esclavo.</p><figure class="img-fluid mb-3"><img src=trigger_replication.jpeg></figure><p class=mb-4>Otro mecanismo de replicación llamado replicación basada en filas se introdujo en MySQL 5.1. Es un tipo de registro binario que proporciona la mejor combinación entre integridad de datos y rendimientos. La replicación basada en filas emplea los archivos de registro de transacciones, copiándolos en la otra instancia donde serán ejecutados. Los archivos de registro están destinados a reproducir una versión funcional de la base de datos en caso de falla, por lo que representan un mecanismo ideal para replicar datos de manera sumamente segura sin causar bloqueos en las operaciones de escritura. Este tipo de replicación siempre funciona de forma asíncrona.</p><figure class="img-fluid mb-3"><img src=log_replication.jpg></figure><p class=mb-4>Una vez comprendidos los conceptos clave, daremos inicio a nuestro taller de replicación empleando contenedores Docker.</p><h3 id=taller-replicación-maestro-esclavo-en-mysql-8x class="blog-desc-big m-0 mb-4">Taller: Replicación maestro-esclavo en MySQL 8.x</h3><h4 id=prerrequisitos class=mb-4>Prerrequisitos</h4><div class="text-list mb-4"><ol><li>Crear una cuenta en <a href=https://hub.docker.com/>DockerHub</a></li><li>Infraestructura de pruebas: <a href=https://labs.play-with-docker.com/>Play with Docker</a></li><li>Número de instancias: 2</li><li>Abre una instancia de <a href=https://labs.play-with-docker.com/>PWD</a> en tu navegador</li></ol></div><h4 id=crear-una-cuenta-en-dockerhub class=mb-4>Crear una cuenta en DockerHub</h4><p class=mb-4>Para poder ejecutar nuestro taller sin necesidad de perder tiempo instalando cosas, voy a emplear la plataforma <a href=https://labs.play-with-docker.com/>Play with Docker</a>, pero primero debes crear una cuenta en <a href=https://hub.docker.com/>DockerHub.</a></p><p class=mb-4>Si aún no cuentas con una cuenta simplemente entra a la <a href=https://hub.docker.com/signup>siguiente liga</a> y crea tu cuenta. Es totalmente gratis para uso personal.</p><p class=mb-4>Ahora con tu cuenta de DockerHub recién creada <a href=https://labs.play-with-docker.com/>accede aquí.</a> Si al momento de entrar te sale un mensaje como el siguiente:</p><blockquote><p>⚠️ <code>We are really sorry but we are out of capacity and cannot create your session at the moment. Please try again later.</code></p></blockquote><p class=mb-4>es indicativo de que el servicio está saturado, solo espera unos minutos y vuelve a intentarlo.</p><h4 id=algunos-detalles-de-la-configuración-inicial class="m-0 mb-4">Algunos detalles de la configuración inicial</h4><div class="text-list mb-4"><ul><li>Imagen Docker a utilizar - percona/percona-server:8.0</li><li>Servidor Maestro – 172.19.0.2/16</li><li>Servidor Esclavo – 172.19.0.3/16</li><li>MySQL Port – 3306</li><li>Versión de Percona – 8.0.32-24</li></ul></div><h4 id=creación-de-docker-composeyml class="m-0 mb-4">Creación de docker-compose.yml</h4><p class=mb-4>Para configurar nuestra pequeña infraestructura utilizaremos el siguiente archivo de docker-compose.yml, recuerda que en los archivos de <a href=https://yaml.com>configuración de YAML</a> es muy importante respetar la identación con espacios:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  mkdir taller-replicacion <span style=color:#666>&amp;&amp;</span> <span style=color:#007020>cd</span> <span style=color:#bb60d5>$_</span> <span style=color:#666>&amp;&amp;</span> mkdir agomezguru <span style=color:#666>&amp;&amp;</span> <span style=color:#007020>cd</span> <span style=color:#bb60d5>$_</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  cat <span style=color:#4070a0>&lt;&lt;EOF &gt; docker-compose.yml
</span></span></span><span style=display:flex><span><span style=color:#4070a0>version: &#39;3&#39;
</span></span></span><span style=display:flex><span><span style=color:#4070a0>
</span></span></span><span style=display:flex><span><span style=color:#4070a0>volumes:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>  agomezguru-masterdb:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    external: true
</span></span></span><span style=display:flex><span><span style=color:#4070a0>  agomezguru-slavedb:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    external: true
</span></span></span><span style=display:flex><span><span style=color:#4070a0>
</span></span></span><span style=display:flex><span><span style=color:#4070a0>services:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>  master:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    image: percona/percona-server:8.0
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    volumes:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - agomezguru-masterdb:/var/lib/mysql
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - ../servidores/masterdb:/etc/my.cnf.d
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - ../servidores/respaldos:/respaldos
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    environment:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      MYSQL_ROOT_PASSWORD: SinPasswordMaestro
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    networks:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - agomezguru-network
</span></span></span><span style=display:flex><span><span style=color:#4070a0>
</span></span></span><span style=display:flex><span><span style=color:#4070a0>  slave:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    image: percona/percona-server:8.0
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    volumes:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - agomezguru-slavedb:/var/lib/mysql
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - ../servidores/slavedb1:/etc/my.cnf.d
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - ../servidores/respaldos:/respaldos
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    depends_on:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      - db
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    environment:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>      MYSQL_ROOT_PASSWORD: SinPasswordEsclavo
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    networks:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>     - agomezguru-network
</span></span></span><span style=display:flex><span><span style=color:#4070a0>
</span></span></span><span style=display:flex><span><span style=color:#4070a0># Isolate docker containers arrays between environments.
</span></span></span><span style=display:flex><span><span style=color:#4070a0>networks:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>  agomezguru-network:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>    driver: bridge
</span></span></span><span style=display:flex><span><span style=color:#4070a0>EOF</span>
</span></span></code></pre></div><p class="mt-4 mb-4">Ahora necesitamos crear los volúmenes nombrados requeridos por las instancias de base de datos:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  docker volume create --name agomezguru-masterdb
</span></span><span style=display:flex><span>  docker volume create --name agomezguru-slavedb
</span></span></code></pre></div><p class="mt-4 mb-4">Ya para finalizar la construcción de nuestra pequeña cama de pruebas creamos los archivos de configuración de cada instancia:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#007020>cd</span> .. <span style=color:#666>&amp;&amp;</span> mkdir servidores <span style=color:#666>&amp;&amp;</span> <span style=color:#007020>cd</span> <span style=color:#bb60d5>$_</span> <span style=color:#666>&amp;&amp;</span> mkdir respaldos <span style=color:#666>&amp;&amp;</span> mkdir masterdb
</span></span><span style=display:flex><span>  mkdir slavedb1 <span style=color:#666>&amp;&amp;</span> <span style=color:#007020>cd</span> masterdb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  cat <span style=color:#4070a0>&lt;&lt;\EOF &gt; config-file.cnf
</span></span></span><span style=display:flex><span><span style=color:#4070a0># Config Settings Master DB:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>[mysqld]
</span></span></span><span style=display:flex><span><span style=color:#4070a0>server-id                       = 1
</span></span></span><span style=display:flex><span><span style=color:#4070a0>binlog_format                   = ROW
</span></span></span><span style=display:flex><span><span style=color:#4070a0>log-bin                         = mysql-bin
</span></span></span><span style=display:flex><span><span style=color:#4070a0>key_buffer_size                 = 64M
</span></span></span><span style=display:flex><span><span style=color:#4070a0>max_allowed_packet              = 64M
</span></span></span><span style=display:flex><span><span style=color:#4070a0>max_connections                 = 210
</span></span></span><span style=display:flex><span><span style=color:#4070a0>explicit_defaults_for_timestamp = 1
</span></span></span><span style=display:flex><span><span style=color:#4070a0>
</span></span></span><span style=display:flex><span><span style=color:#4070a0>[mysqldump]
</span></span></span><span style=display:flex><span><span style=color:#4070a0>max_allowed_packet = 64M
</span></span></span><span style=display:flex><span><span style=color:#4070a0>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020>cd</span> .. <span style=color:#666>&amp;&amp;</span> <span style=color:#007020>cd</span> slavedb1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#4070a0>&lt;&lt;\EOF &gt; config-file.cnf
</span></span></span><span style=display:flex><span><span style=color:#4070a0># Config Settings Slave DB:
</span></span></span><span style=display:flex><span><span style=color:#4070a0>[mysqld]
</span></span></span><span style=display:flex><span><span style=color:#4070a0>server-id                       = 101
</span></span></span><span style=display:flex><span><span style=color:#4070a0>binlog_format                   = ROW
</span></span></span><span style=display:flex><span><span style=color:#4070a0>log-bin                         = mysql-bin
</span></span></span><span style=display:flex><span><span style=color:#4070a0>key_buffer_size                 = 64M
</span></span></span><span style=display:flex><span><span style=color:#4070a0>max_allowed_packet              = 64M
</span></span></span><span style=display:flex><span><span style=color:#4070a0>max_connections                 = 210
</span></span></span><span style=display:flex><span><span style=color:#4070a0>explicit_defaults_for_timestamp = 1
</span></span></span><span style=display:flex><span><span style=color:#4070a0>#relay-log                       = 
</span></span></span><span style=display:flex><span><span style=color:#4070a0>
</span></span></span><span style=display:flex><span><span style=color:#4070a0>[mysqldump]
</span></span></span><span style=display:flex><span><span style=color:#4070a0>max_allowed_packet = 64M
</span></span></span><span style=display:flex><span><span style=color:#4070a0>
</span></span></span><span style=display:flex><span><span style=color:#4070a0>EOF</span>
</span></span></code></pre></div><p class="mt-4 mb-4">En resumen, nuestro directorio de trabajo debe verse así:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#007020>cd</span> ~/taller-replicacion <span style=color:#666>&amp;&amp;</span> tree
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  .
</span></span><span style=display:flex><span>  ├── agomezguru
</span></span><span style=display:flex><span>  │   └── docker-compose.yml
</span></span><span style=display:flex><span>  └── servidores
</span></span><span style=display:flex><span>      ├── masterdb
</span></span><span style=display:flex><span>      │   └── config-file.cnf
</span></span><span style=display:flex><span>      ├── respaldos
</span></span><span style=display:flex><span>      └── slavedb1
</span></span><span style=display:flex><span>          └── config-file.cnf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#40a070>5</span> directories, <span style=color:#40a070>3</span> files
</span></span></code></pre></div><p class="mt-4 mb-4">con dos volúmenes nombrados:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  docker volume ls
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  DRIVER    VOLUME NAME
</span></span><span style=display:flex><span>  <span style=color:#007020>local</span>     agomezguru-masterdb
</span></span><span style=display:flex><span>  <span style=color:#007020>local</span>     agomezguru-slavedb
</span></span></code></pre></div><p class="mt-4 mb-4">Ahora ya podemos iniciar nuestras dos instancias de bases de datos y empezar nuestra práctica, pero antes quiero explicar por qué seleccioné esa configuración para los servidores Maestro y Esclavo.</p><p class=mb-4>Como ya dije, emplearemos la replicación basada en filas (<em>binlog_format</em>). Entonces, para configurar este tipo de replicación, es obligatorio habilitar los registros binarios (<em>log-bin</em>). Asimismo, es necesario configurar los ID en los servidores, tanto en el servidor Maestro como en el(los) servidor(es) Esclavo(s), el cual debe ser único e irrepetible.</p><h4 id=maestro-paso-1 class="m-0 mb-4">Maestro: Paso #1</h4><p class=mb-4>Iniciando los contenedores y revisando que todo esté en orden:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#007020>cd</span> ~/taller-replicacion/agomezguru
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  docker-compose up -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>+<span style=color:#666>]</span> Running 8/8
</span></span><span style=display:flex><span>  ⠿ master Pulled                                                               23.3s
</span></span><span style=display:flex><span>  ⠿ slave Pulled                                                                23.3s
</span></span><span style=display:flex><span>    ⠿ 56f7a0abdb77 Pull <span style=color:#007020>complete</span>                                                 5.9s
</span></span><span style=display:flex><span>    ⠿ e84fb532f1e3 Pull <span style=color:#007020>complete</span>                                                 6.0s
</span></span><span style=display:flex><span>    ⠿ 15377560deef Pull <span style=color:#007020>complete</span>                                                 6.3s
</span></span><span style=display:flex><span>    ⠿ 659e56984cf7 Pull <span style=color:#007020>complete</span>                                                22.3s
</span></span><span style=display:flex><span>    ⠿ bdc622d377c1 Pull <span style=color:#007020>complete</span>                                                22.5s
</span></span><span style=display:flex><span>    ⠿ 753d3189b481 Pull <span style=color:#007020>complete</span>                                                22.6s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>+<span style=color:#666>]</span> Running 3/3
</span></span><span style=display:flex><span>  ⠿ Network agomezguru_agomezguru-network  Created                               0.1s
</span></span><span style=display:flex><span>  ⠿ Container agomezguru-master-1          St...                                 0.8s
</span></span><span style=display:flex><span>  ⠿ Container agomezguru-slave-1           Sta...                                0.9s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  docker-compose ps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  NAME                  COMMAND                  SERVICE   STATUS    PORTS
</span></span><span style=display:flex><span>  agomezguru-master-1   <span style=color:#4070a0>&#34;/docker-entrypoint.…&#34;</span>   master    running   3306/tcp, 33060/tcp
</span></span><span style=display:flex><span>  agomezguru-slave-1    <span style=color:#4070a0>&#34;/docker-entrypoint.…&#34;</span>   slave     running   3306/tcp, 33060/tcp
</span></span></code></pre></div><p class="mt-4 mb-4">Comprobando conectividad entre contenedores:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  docker <span style=color:#007020>exec</span> -it agomezguru-master-1 ping agomezguru-slave-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  PING agomezguru-slave-1 <span style=color:#666>(</span>172.19.0.3<span style=color:#666>)</span> 56<span style=color:#666>(</span>84<span style=color:#666>)</span> bytes of data.
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-slave-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.3<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>1</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.286 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-slave-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.3<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>2</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.121 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-slave-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.3<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>3</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.145 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-slave-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.3<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>4</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.122 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-slave-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.3<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>5</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.132 ms
</span></span><span style=display:flex><span>  ^C
</span></span><span style=display:flex><span>  --- agomezguru-slave-1 ping statistics ---
</span></span><span style=display:flex><span>  <span style=color:#40a070>5</span> packets transmitted, <span style=color:#40a070>5</span> received, 0% packet loss, <span style=color:#007020>time</span> 4003ms
</span></span><span style=display:flex><span>  rtt min/avg/max/mdev <span style=color:#666>=</span> 0.121/0.161/0.286/0.063 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  docker <span style=color:#007020>exec</span> -it agomezguru-slave-1 ping agomezguru-master-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  PING agomezguru-master-1 <span style=color:#666>(</span>172.19.0.2<span style=color:#666>)</span> 56<span style=color:#666>(</span>84<span style=color:#666>)</span> bytes of data.
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-master-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.2<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>1</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.155 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-master-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.2<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>2</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.094 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-master-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.2<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>3</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.089 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-master-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.2<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>4</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.125 ms
</span></span><span style=display:flex><span>  <span style=color:#40a070>64</span> bytes from agomezguru-master-1.agomezguru_agomezguru-network <span style=color:#666>(</span>172.19.0.2<span style=color:#666>)</span>: <span style=color:#bb60d5>icmp_seq</span><span style=color:#666>=</span><span style=color:#40a070>5</span> <span style=color:#bb60d5>ttl</span><span style=color:#666>=</span><span style=color:#40a070>64</span> <span style=color:#bb60d5>time</span><span style=color:#666>=</span>0.082 ms
</span></span><span style=display:flex><span>  ^C
</span></span><span style=display:flex><span>  --- agomezguru-master-1 ping statistics ---
</span></span><span style=display:flex><span>  <span style=color:#40a070>5</span> packets transmitted, <span style=color:#40a070>5</span> received, 0% packet loss, <span style=color:#007020>time</span> 4000ms
</span></span><span style=display:flex><span>  rtt min/avg/max/mdev <span style=color:#666>=</span> 0.082/0.109/0.155/0.027 ms
</span></span></code></pre></div><p class="mt-4 mb-4">Accediendo y revisando las tablas del Maestro:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ docker <span style=color:#007020>exec</span> -u root -it agomezguru-master-1 bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@657c8d90f1ce /<span style=color:#666>]</span><span style=color:#60a0b0;font-style:italic># mysql -u root -pSinPasswordMaestro</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; show databases;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  +--------------------+
</span></span><span style=display:flex><span>  | Database           |
</span></span><span style=display:flex><span>  +--------------------+
</span></span><span style=display:flex><span>  | information_schema |
</span></span><span style=display:flex><span>  | mysql              |
</span></span><span style=display:flex><span>  | performance_schema |
</span></span><span style=display:flex><span>  | sys                |
</span></span><span style=display:flex><span>  +--------------------+
</span></span><span style=display:flex><span>  <span style=color:#40a070>4</span> rows in <span style=color:#007020>set</span> <span style=color:#666>(</span>0.01 sec<span style=color:#666>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; <span style=color:#007020>exit</span>
</span></span></code></pre></div><h4 id=maestro-paso-2 class="mt-4 mb-4">Maestro: Paso #2</h4><p class=mb-4>Sin salir de la línea de comandos del contenedor, hagamos una copia de seguridad completa del Maestro usando <em>mysqldump</em>.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#666>[</span>root@657c8d90f1ce /<span style=color:#666>]</span><span style=color:#60a0b0;font-style:italic># cd respaldos/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>root@657c8d90f1ce respaldos<span style=color:#666>]</span><span style=color:#60a0b0;font-style:italic># mysqldump -u root -pSinPasswordMaestro --all-databases --source-data=1 --events --routines --triggers --single-transaction &gt; maestro.sql</span>
</span></span></code></pre></div><h4 id=maestro-paso-3 class="mt-4 mb-4">Maestro: Paso #3</h4><p class=mb-4>En seguida vamos a crear un usuario para la replicación.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  mysql -u root -pSinPasswordMaestro
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; CREATE USER agomezguru@<span style=color:#4070a0>&#39;%&#39;</span> IDENTIFIED BY <span style=color:#4070a0>&#39;SinPasswordBD&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; GRANT REPLICATION SLAVE ON *.* TO agomezguru@<span style=color:#4070a0>&#39;%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; flush privileges;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; <span style=color:#007020>exit</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>root@657c8d90f1ce respaldos<span style=color:#666>]</span><span style=color:#60a0b0;font-style:italic># exit</span>
</span></span></code></pre></div><h4 id=esclavo-paso-1 class="mt-4 mb-4">Esclavo: Paso #1</h4><p class=mb-4>Restaurar la copia de seguridad del servidor Maestro (Paso #2) en el servidor esclavo.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ docker <span style=color:#007020>exec</span> -it agomezguru-slave-1 bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@cb8aa9414f55<span style=color:#666>]</span>$ <span style=color:#007020>cd</span> respaldos/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@cb8aa9414f55 respaldos<span style=color:#666>]</span>$ mysql -u root -pSinPasswordEsclavo &lt; maestro.sql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@cb8aa9414f55 respaldos<span style=color:#666>]</span>$ <span style=color:#007020>exit</span>
</span></span></code></pre></div><h4 id=esclavo-paso-2 class="mt-4 mb-4">Esclavo: Paso #2</h4><p class=mb-4>Con la ejecución de los siguientes comandos vamos a extraer, de entre las primeras 35 líneas del archivo de copia de seguridad, el nombre y la posición del archivo de registro binario.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ <span style=color:#007020>cd</span> ~/taller-replicacion/servidores/respaldos
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  $ head -n <span style=color:#40a070>35</span> maestro.sql | grep <span style=color:#4070a0>&#39;MASTER_LOG_FILE&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  CHANGE MASTER TO <span style=color:#bb60d5>MASTER_LOG_FILE</span><span style=color:#666>=</span><span style=color:#4070a0>&#39;mysql-bin.000003&#39;</span>, <span style=color:#bb60d5>MASTER_LOG_POS</span><span style=color:#666>=</span>157;
</span></span></code></pre></div><h4 id=esclavo-paso-3 class="mt-4 mb-4">Esclavo: Paso #3</h4><p class=mb-4>Con estos datos construiremos la siguiente instrucción de MySQL, la cual vamos a ejecutar dentro del contenedor Esclavo. Aquí MASTER_HOST es el nombre de host del servidor Maestro, MASTER_USER y MASTER_PASSWORD son el nombre de usuario y la contraseña que creamos en el <em><a href=#maestro-paso-3>Maestro: Paso 3</a>.</em> MASTER_LOG_FILE y MASTER_LOG_POS son del paso anterior.</p><p class=mb-4><em><strong>Nota:</strong></em> Desde MySQL Server 8.0.11 se utiliza como método de autenticación <em>&lsquo;caching_sha2_password&rsquo;</em> pero si lo dejas con este valor dará un error y la replicación no iniciará. Para evitarlo voy a forzar el inicio de sesión con el método anterior empleando GET_MASTER_PUBLIC_KEY=1</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ docker <span style=color:#007020>exec</span> -it agomezguru-slave-1 bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@cb8aa9414f55<span style=color:#666>]</span>$ mysql -u root -pSinPasswordEsclavo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; CHANGE MASTER TO <span style=color:#bb60d5>MASTER_HOST</span><span style=color:#666>=</span><span style=color:#4070a0>&#39;master&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#bb60d5>MASTER_USER</span><span style=color:#666>=</span><span style=color:#4070a0>&#39;agomezguru&#39;</span>, <span style=color:#bb60d5>MASTER_PASSWORD</span><span style=color:#666>=</span><span style=color:#4070a0>&#39;SinPasswordBD&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#bb60d5>MASTER_LOG_FILE</span><span style=color:#666>=</span><span style=color:#4070a0>&#39;mysql-bin.000003&#39;</span>, <span style=color:#bb60d5>MASTER_LOG_POS</span><span style=color:#666>=</span>157;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; CHANGE MASTER TO <span style=color:#bb60d5>GET_MASTER_PUBLIC_KEY</span><span style=color:#666>=</span>1;
</span></span></code></pre></div><h4 id=esclavo-paso-4 class="mt-4 mb-4">Esclavo: Paso #4</h4><p class=mb-4>Ahora vamos a iniciar la replicación verificando su estado:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  mysql&gt; START SLAVE;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; SHOW SLAVE STATUS<span style=color:#4070a0;font-weight:700>\G</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  *************************** 1. row ***************************
</span></span><span style=display:flex><span>                Slave_IO_State: Waiting <span style=color:#007020;font-weight:700>for</span> <span style=color:#007020>source</span> to send event
</span></span><span style=display:flex><span>                    Master_Host: db
</span></span><span style=display:flex><span>                    Master_User: agomezguru
</span></span><span style=display:flex><span>                    Master_Port: <span style=color:#40a070>3306</span>
</span></span><span style=display:flex><span>                  Connect_Retry: <span style=color:#40a070>60</span>
</span></span><span style=display:flex><span>                Master_Log_File: mysql-bin.000003
</span></span><span style=display:flex><span>            Read_Master_Log_Pos: <span style=color:#40a070>869</span>
</span></span><span style=display:flex><span>                Relay_Log_File: cb8aa9414f55-relay-bin.000002
</span></span><span style=display:flex><span>                  Relay_Log_Pos: <span style=color:#40a070>1038</span>
</span></span><span style=display:flex><span>          Relay_Master_Log_File: mysql-bin.000003
</span></span><span style=display:flex><span>              Slave_IO_Running: Yes
</span></span><span style=display:flex><span>              Slave_SQL_Running: Yes
</span></span><span style=display:flex><span>                Replicate_Do_DB: 
</span></span><span style=display:flex><span>            Replicate_Ignore_DB: 
</span></span><span style=display:flex><span>            Replicate_Do_Table: 
</span></span><span style=display:flex><span>        Replicate_Ignore_Table: 
</span></span><span style=display:flex><span>        Replicate_Wild_Do_Table: 
</span></span><span style=display:flex><span>    Replicate_Wild_Ignore_Table: 
</span></span><span style=display:flex><span>                    Last_Errno: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>                    Last_Error: 
</span></span><span style=display:flex><span>                  Skip_Counter: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>            Exec_Master_Log_Pos: <span style=color:#40a070>869</span>
</span></span><span style=display:flex><span>                Relay_Log_Space: <span style=color:#40a070>1255</span>
</span></span><span style=display:flex><span>                Until_Condition: None
</span></span><span style=display:flex><span>                Until_Log_File: 
</span></span><span style=display:flex><span>                  Until_Log_Pos: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>            Master_SSL_Allowed: No
</span></span><span style=display:flex><span>            Master_SSL_CA_File: 
</span></span><span style=display:flex><span>            Master_SSL_CA_Path: 
</span></span><span style=display:flex><span>                Master_SSL_Cert: 
</span></span><span style=display:flex><span>              Master_SSL_Cipher: 
</span></span><span style=display:flex><span>                Master_SSL_Key: 
</span></span><span style=display:flex><span>          Seconds_Behind_Master: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>  Master_SSL_Verify_Server_Cert: No
</span></span><span style=display:flex><span>                  Last_IO_Errno: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>                  Last_IO_Error: 
</span></span><span style=display:flex><span>                Last_SQL_Errno: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>                Last_SQL_Error: 
</span></span><span style=display:flex><span>    Replicate_Ignore_Server_Ids: 
</span></span><span style=display:flex><span>              Master_Server_Id: <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>                    Master_UUID: 26e33209-d247-11ed-b92f-0242ac130002
</span></span><span style=display:flex><span>              Master_Info_File: mysql.slave_master_info
</span></span><span style=display:flex><span>                      SQL_Delay: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>            SQL_Remaining_Delay: NULL
</span></span><span style=display:flex><span>        Slave_SQL_Running_State: Replica has <span style=color:#007020>read</span> all relay log; waiting <span style=color:#007020;font-weight:700>for</span> more updates
</span></span><span style=display:flex><span>            Master_Retry_Count: <span style=color:#40a070>86400</span>
</span></span><span style=display:flex><span>                    Master_Bind: 
</span></span><span style=display:flex><span>        Last_IO_Error_Timestamp: 
</span></span><span style=display:flex><span>      Last_SQL_Error_Timestamp: 
</span></span><span style=display:flex><span>                Master_SSL_Crl: 
</span></span><span style=display:flex><span>            Master_SSL_Crlpath: 
</span></span><span style=display:flex><span>            Retrieved_Gtid_Set: 
</span></span><span style=display:flex><span>              Executed_Gtid_Set: 
</span></span><span style=display:flex><span>                  Auto_Position: <span style=color:#40a070>0</span>
</span></span><span style=display:flex><span>          Replicate_Rewrite_DB: 
</span></span><span style=display:flex><span>                  Channel_Name: 
</span></span><span style=display:flex><span>            Master_TLS_Version: 
</span></span><span style=display:flex><span>        Master_public_key_path: 
</span></span><span style=display:flex><span>          Get_master_public_key: <span style=color:#40a070>1</span>
</span></span><span style=display:flex><span>              Network_Namespace: 
</span></span><span style=display:flex><span>  <span style=color:#40a070>1</span> row in set, <span style=color:#40a070>1</span> warning <span style=color:#666>(</span>0.01 sec<span style=color:#666>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; <span style=color:#007020>exit</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@cb8aa9414f55 /<span style=color:#666>]</span>$ <span style=color:#007020>exit</span>
</span></span></code></pre></div><p class="mt-4 mb-4">Para verificar que la replicación está funcionado bien, revisa que se muestren los siguientes valores:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  Slave_IO_Running: Yes
</span></span><span style=display:flex><span>  Slave_SQL_Running: Yes
</span></span><span style=display:flex><span>  Seconds_Behind_Master: <span style=color:#40a070>0</span>
</span></span></code></pre></div><p class=mb-4>Si ambos valores <strong>Slave_IO_Running</strong> y <strong>Slave_SQL_Running</strong> son <strong>Yes</strong>, entonces está replicando correctamente. Si alguno de los valores es &ldquo;No&rdquo;, revisa todos los pasos cuidadosamente.</p><p class=mb-4>Si el valor de <strong>Seconds_Behind_Master</strong> es <strong>0</strong> significa que la replicación en el Esclavo está sincronizado con su Maestro. Si el valor es <strong>10</strong>, significa que el Esclavo está 10 segundos por detrás de su Maestro.</p><h4 id=esclavo-paso-5 class="mt-4 mb-4">Esclavo: Paso #5</h4><p class=mb-4>Ya que hemos comprobado que todo está en orden, solo nos falta el último paso, configurar el servidor Esclavo para que, si necesitas interrumpir la ejecución de tus contenedores, cuando los vuelvas a iniciar reinicie la replicación sin contratiempos. Para ello vamos a quitar el comentario de <strong>#relay-log</strong> y configuraremos el valor devuelto por <strong>Relay_Log_File</strong> en el paso anterior:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>  $ <span style=color:#007020>cd</span> ~/taller-replicacion/servidores/slavedb1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  $ vim config-file.cnf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  relay-log <span style=color:#666>=</span> cb8aa9414f55-relay-bin
</span></span></code></pre></div><h3 id=verificación-final-del-arreglo-maestro-esclavo class="blog-desc-big m-0 mt-4 mb-4">Verificación final del arreglo maestro-esclavo</h3><p class=mb-4>Con esto hemos concluido satisfactoriamente la configuración del arreglo. Solo para confirmar que efectivamente está replicando en forma correcta, voy a crear una tabla en el Maestro con algún dato y los cambios se deben de reflejar en el Esclavo.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ docker <span style=color:#007020>exec</span> -it agomezguru-master-1 bash
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@657c8d90f1ce /<span style=color:#666>]</span>$ mysql -u root -pSinPasswordMaestro
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; CREATE SCHEMA taller_replicacion;
</span></span><span style=display:flex><span>  mysql&gt; use taller_replicacion;
</span></span><span style=display:flex><span>  mysql&gt; CREATE TABLE IF NOT EXISTS mi_test <span style=color:#666>(</span>
</span></span><span style=display:flex><span>      id INT AUTO_INCREMENT PRIMARY KEY,
</span></span><span style=display:flex><span>      title VARCHAR<span style=color:#666>(</span>255<span style=color:#666>)</span> NOT NULL,
</span></span><span style=display:flex><span>      description TEXT,
</span></span><span style=display:flex><span>      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
</span></span><span style=display:flex><span>  <span style=color:#666>)</span>  <span style=color:#bb60d5>ENGINE</span><span style=color:#666>=</span>INNODB;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; INSERT INTO mi_test<span style=color:#666>(</span>title, description<span style=color:#666>)</span>
</span></span><span style=display:flex><span>  VALUES<span style=color:#666>(</span><span style=color:#4070a0>&#34;Aprendiendo a replicar&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#4070a0>&#34;Taller teórico práctico&#34;</span><span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; <span style=color:#007020>exit</span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@657c8d90f1ce /<span style=color:#666>]</span>$ <span style=color:#007020>exit</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  $ docker <span style=color:#007020>exec</span> -it agomezguru-slave-1 bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@cb8aa9414f55<span style=color:#666>]</span>$ mysql -u agomezguru -pSinPasswordMaestro
</span></span><span style=display:flex><span>  mysql&gt; show databases;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  +--------------------+
</span></span><span style=display:flex><span>  | Database           |
</span></span><span style=display:flex><span>  +--------------------+
</span></span><span style=display:flex><span>  | information_schema |
</span></span><span style=display:flex><span>  | mysql              |
</span></span><span style=display:flex><span>  | performance_schema |
</span></span><span style=display:flex><span>  | sys                |
</span></span><span style=display:flex><span>  | taller_replicacion |
</span></span><span style=display:flex><span>  +--------------------+
</span></span><span style=display:flex><span>  <span style=color:#40a070>5</span> rows in <span style=color:#007020>set</span> <span style=color:#666>(</span>0.01 sec<span style=color:#666>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; use taller_replicacion
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; show tables;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  +------------------------------+
</span></span><span style=display:flex><span>  | Tables_in_taller_replicacion |
</span></span><span style=display:flex><span>  +------------------------------+
</span></span><span style=display:flex><span>  | mi_test                      |
</span></span><span style=display:flex><span>  +------------------------------+
</span></span><span style=display:flex><span>  <span style=color:#40a070>1</span> row in <span style=color:#007020>set</span> <span style=color:#666>(</span>0.00 sec<span style=color:#666>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; describe mi_test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  +-------------+--------------+------+-----+-------------------+-------------------+
</span></span><span style=display:flex><span>  | Field       | Type         | Null | Key | Default           | Extra             |
</span></span><span style=display:flex><span>  +-------------+--------------+------+-----+-------------------+-------------------+
</span></span><span style=display:flex><span>  | id          | int          | NO   | PRI | NULL              | auto_increment    |
</span></span><span style=display:flex><span>  | title       | varchar<span style=color:#666>(</span>255<span style=color:#666>)</span> | NO   |     | NULL              |                   |
</span></span><span style=display:flex><span>  | description | text         | YES  |     | NULL              |                   |
</span></span><span style=display:flex><span>  | created_at  | timestamp    | YES  |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
</span></span><span style=display:flex><span>  +-------------+--------------+------+-----+-------------------+-------------------+
</span></span><span style=display:flex><span>  <span style=color:#40a070>4</span> rows in <span style=color:#007020>set</span> <span style=color:#666>(</span>0.00 sec<span style=color:#666>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; <span style=color:#007020;font-weight:700>select</span> * from mi_test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  +----+------------------------+---------------------------+---------------------+
</span></span><span style=display:flex><span>  | id | title                  | description               | created_at          |
</span></span><span style=display:flex><span>  +----+------------------------+---------------------------+---------------------+
</span></span><span style=display:flex><span>  |  <span style=color:#40a070>1</span> | Aprendiendo a replicar | Taller teórico práctico | 2023-04-06 14:48:09 |
</span></span><span style=display:flex><span>  +----+------------------------+---------------------------+---------------------+
</span></span><span style=display:flex><span>  <span style=color:#40a070>1</span> row in <span style=color:#007020>set</span> <span style=color:#666>(</span>0.00 sec<span style=color:#666>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mysql&gt; <span style=color:#007020>exit</span>
</span></span><span style=display:flex><span>  <span style=color:#666>[</span>mysql@657c8d90f1ce /<span style=color:#666>]</span>$ <span style=color:#007020>exit</span>
</span></span></code></pre></div><p class=mt-4>Si eres observador, habrás notado que al introducir la contraseña del servidor Esclavo ya no utilicé la configurada inicialmente en el archivo docker-composer.yml, sino la misma del servidor Maestro, esto es así porque al sacar una copia completa en el <a href=#maestro-paso-2>Maestro: Paso #2</a> también clonó su contraseña.</p><h3 id=conclusión class="blog-desc-big m-0 mt-4 mb-4">Conclusión</h3><p class=mb-4>La replicación maestro-esclavo mediante filas empleando logs binarios, es un método muy eficiente que, sumado a un despliegue típico empleando contenedores Docker, nos permite desplegar una infraestructura poco costosa en recursos informáticos y en consecuencia muy <em>ad-hoc</em> para su empleo en proyectos de largo alcance, que debidamente combinado con otras tecnologías que iremos descubriendo juntos a lo largo de este blog, nos permite alcanzar niveles en los acuerdos de servicio (SLA&rsquo;s) cercanos al 99.98%.</p><h3 id=referencias class="blog-desc-big m-0 mt-4 mb-4">Referencias</h3><div class="text-list mb-4"><ul><li><p><a href=https://kapilyadavalli.wordpress.com/2020/03/26/configure-a-simple-master-slave-replication-in-mysql-mariadb-percona/>Configure Master-Slave Replication in MySQL/MariaDB/Percona</a></p></li><li><p><a href=https://webyog.com/blog/monyog/setting-basic-master-slave-replication-mysql-8/>Setting up Basic Master-Slave Replication in MySQL 8</a></p></li><li><p><a href=https://labs.play-with-docker.com/>Play with Docker</a></p></li><li><p><a href=https://hub.docker.com/>DockerHub</a></p></li></ul></div><h3 id=créditos class="blog-desc-big m-0 mt-4 mb-4">Créditos</h3><div class="text-list-gray mb-4"><ul><li><p>Figura 1. Trigger-based replication | From Wikimedia Commons, the free media repository</p></li><li><p>Figura 2. Log-based replication | From Wikimedia Commons, the free media repository</p></li></ul></div><div class="d-grid left-right mt-5 pb-md-5"><div class="buttons-singles tags"><h4>Etiquetas :</h4><a href=/etiquetas/devops>DevOps</a>
<a href=/etiquetas/dbs>DB's</a>
<a href=/etiquetas/replicaci%C3%B3n>Replicación</a>
<a href=/etiquetas/taller>Taller</a></div><div class=buttons-singles><h4>Compartir :</h4><a href=https://www.linkedin.com/in/alejandro-gomez-lagunas-12748212/><span class="fa fa-linkedin" aria-hidden=true></span></a>
<a href=https://github.com/agomezguru><span class="fa fa-github" aria-hidden=true></span></a>
<a href=mailto:alagunas@coati.com.mx><span class="fa fa-envelope" aria-hidden=true></span></a></div></div></div></div></article></section></main><footer class=w3l-footer-16><div class="footer-content py-lg-5 py-4 text-center"><div class=container><div class=copy-right><h6>© 2023 GitHub Blog: Made with <span class="fa fa-heart" aria-hidden=true></span>;
Coded with <a href=https://gohugo.io/>Hugo</a>; Designed by <a href=https://w3layouts.com/><strong>W3layouts</strong></a></h6></div><ul class="author-icons mt-4"><li><a class=linkedin href=https://www.linkedin.com/in/alejandro-gomez-lagunas-12748212/><span class="fa fa-linkedin" aria-hidden=true></span></a></li><li><a class=github href=https://github.com/agomezguru><span class="fa fa-github" aria-hidden=true></span></a></li><li><a href=mailto:alagunas@coati.com.mx><span class="fa fa-envelope" aria-hidden=true></span></a></li></ul><button onclick=topFunction() id=movetop title="Go to top">
<span class="fa fa-angle-up"></span></button></div></div><script>window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?document.getElementById("movetop").style.display="block":document.getElementById("movetop").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></footer><script src=https://agomezguru.github.io/js/theme-change.js></script>
<script src=https://agomezguru.github.io/js/jquery-3.3.1.min.js></script>
<script>$(function(){$(".navbar-toggler").click(function(){$("body").toggleClass("noscroll")})})</script><script src=https://agomezguru.github.io/js/bootstrap.min.js></script></body></html>